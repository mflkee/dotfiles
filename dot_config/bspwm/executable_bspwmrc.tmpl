#! /bin/sh

# Запуск sxhkd, если ещё не запущен
pgrep -x sxhkd > /dev/null || sxhkd &

# Автоматическое определение мониторов
MONITORS=$(xrandr --query | grep " connected" | cut -d" " -f1)


# Настройка мониторов через xrandr (пример для вашей конфигурации)
xrandr --output eDP-1 --primary --mode 1920x1080 --rate 60 \
       --output HDMI-1 --mode 1920x1080 --rate 60 --right-of eDP-1

# Небольшая задержка для применения изменений
sleep 1

# Сброс предыдущих настроек
bspc wm --reset-monitors

# Распределение рабочих столов между мониторами
if xrandr | grep -q "HDMI-1 connected"; then
    bspc monitor eDP-1 -d 1 2 3 4 5
    bspc monitor HDMI-1 -d 6 7 8 9
else
    # Если второй монитор отключен, назначаем все рабочие столы на основной
    bspc monitor eDP-1 -d 1 2 3 4 5 6 7 8 9
fi

# Запуск Polybar
$HOME/.config/polybar/launch.sh &

# Установка курсора
xsetroot -cursor_name left_ptr

(sleep 2 && feh --bg-scale --randomize ~/.config/wallpaper/*) &

# Запуск xscreensaver и других утилит
#xscreensaver -no-splash &
udiskie &
dunst &

# Задержка для стабильности
sleep 2  # Увеличил задержку перед запуском Polybar


# Запуск других скриптов
(sleep 5 && ~/.config/bspwm/scripts/download_manager.sh) &

# Настройки bspwm
bspc config border_width 2
bspc config window_gap 5
bspc config split_ratio 0.50
bspc config borderless_monocle false
bspc config gapless_monocle true

# Правила для окон
bspc rule -a \* -d any

# Цвета для окон
bspc config normal_border_color "#282A36"
bspc config active_border_color "#FF79C6"
bspc config focused_border_color "#FFB86C"
bspc config presel_feedback_color "#BD93F9"

# Конфигурация фокуса
bspc config focus_follows_pointer true
bspc config pointer_modifier super
bspc config automatic_scheme alternate
